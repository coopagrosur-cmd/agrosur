<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AgroSur ‚Äì Frutas y Verduras</title>

  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; background: #fffdf5; }
    header { background: linear-gradient(90deg, #ff9800, #4caf50); color: white; padding: 25px; text-align: center; }
    header h1 { margin: 0; font-size: 2.2em; }

    /* header con logo y texto */
    .header-contenido {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 18px;
      flex-wrap: wrap;
      text-align: center;
    }
    .logo { max-width: 120px; }
    .texto-header h1 { margin: 0; font-size: 2.2em; }
    .texto-header p { margin: 5px 0 0; font-size: 1.1em; font-weight: 500; }

    section { padding: 25px; max-width: 1200px; margin: auto; }
    h2 { margin-top: 40px; }
    .frutas { color: #e53935; }
    .verduras { color: #2e7d32; }
    .hortalizas { color: #6a1b9a; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 18px; }
    .card { background: white; border-radius: 14px; padding: 15px; box-shadow: 0 6px 14px rgba(0,0,0,0.12); text-align: center; }
    .card img { width: 100%; height: 150px; object-fit: cover; border-radius: 10px; }
    .precio { font-size: 1.1em; font-weight: bold; margin: 8px 0; }
    button { background: #ff9800; color: white; border: none; padding: 10px; width: 100%; border-radius: 8px; cursor: pointer; font-size: 1em; }
    button:hover { background: #fb8c00; }
    footer { background: #2e7d32; color: white; text-align: center; padding: 18px; margin-top: 120px; }

    #carrito {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #ffffff;
      border-top: 3px solid #4caf50;
      padding: 15px;
      box-shadow: 0 -4px 10px rgba(0,0,0,0.15);
    }
    #carrito h3 { margin-top: 0; }

    .filtros { text-align: center; margin-bottom: 20px; }
    .filtros button { width: auto; margin: 5px; padding: 10px 18px; }
  </style>
</head>
<body>

<header>
  <div class="header-contenido">
    <img 
      src="https://drive.google.com/uc?id=1mRQfGgIRoEBvHi8AsMIzeFu6afQ_actf"
      alt="AgroSur Logo"
      class="logo"
    >
    <div class="texto-header">
      <h1>AgroSur Frutas y Verduras</h1>
      <p>Del productor a tu mesa</p>
    </div>
  </div>
</header>

<section>
  <h2>üì¶ Cajas Armadas</h2>
  <div class="grid" id="cajas"></div>
</section>

<section>
  <div class="filtros">
    <button onclick="mostrarCategoria('todas')">Todos</button>
    <button onclick="mostrarCategoria('frutas')">Frutas</button>
    <button onclick="mostrarCategoria('verduras')">Verduras</button>
    <button onclick="mostrarCategoria('hortalizas')">Hortalizas</button>
  </div>

  <h2 class="frutas">üçé Frutas</h2>
  <div class="grid categoria" id="frutas"></div>

  <h2 class="verduras">ü•¨ Verduras</h2>
  <div class="grid categoria" id="verduras"></div>

  <h2 class="hortalizas">üå± Hortalizas</h2>
  <div class="grid categoria" id="hortalizas"></div>
</section>

<div id="carrito">
  <h3>üß∫ Tu caja</h3>
  <div id="items"></div>
  <p><strong>Total estimado: $<span id="total">0</span></strong></p>
  <button onclick="finalizarPedido()">Finalizar pedido por WhatsApp</button>
</div>

<footer>
  <p>üìç Entregas coordinadas | üí∞ Pago: efectivo o transferencia</p>
</footer>

<script>
  const telefono = '5492213084604'; // CAMBIAR POR TU WHATSAPP

  const sheetProductos = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSslFktyPHbT0hm76An5Y5zwQlT98bQSiMQgTz7hXDs5AngXqHbFOpm5vs_hINDF4SAILG1s1Rm95NR/pub?gid=0&single=true&output=csv';
  const sheetCajas = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSOm48PgZGpZtF2vxg2g5UX1xB0ZN4Xmw3ZRIwxAFk3O6jXI5eqhLub-FaaIT/pub?gid=0&single=true&output=csv';

  let carrito = [];

  // Cargar datos al iniciar
  fetch(sheetProductos).then(r => r.text()).then(cargarProductos);
  fetch(sheetCajas).then(r => r.text()).then(cargarCajas);

  /*** PARSER CSV SIMPLE QUE RESPETA COMILLAS ***/
  function parseCSV(text) {
    const rows = [];
    let current = [];
    let value = '';
    let insideQuotes = false;

    for (let i = 0; i < text.length; i++) {
      const char = text[i];

      // doble comilla dentro de comillas
      if (char === '"' && text[i + 1] === '"') {
        value += '"';
        i++;
      } else if (char === '"') {
        insideQuotes = !insideQuotes;
      } else if (char === ',' && !insideQuotes) {
        current.push(value);
        value = '';
      } else if (char === '\n' && !insideQuotes) {
        current.push(value);
        rows.push(current);
        current = [];
        value = '';
      } else {
        value += char;
      }
    }

    // √∫ltima fila si queda
    if (value) {
      current.push(value);
      rows.push(current);
    }

    return rows;
  }

  /*** CARGAR PRODUCTOS DESDE CSV ***/
  function cargarProductos(csv) {
    const filas = parseCSV(csv).slice(1); // quitar encabezado

    filas.forEach(f => {
      const [categoria, nombre, precio, unidad, imagen] = f;
      if (!nombre || !imagen) return;

      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${imagen.trim()}" alt="${nombre}">
        <h3>${nombre}</h3>
        <div class="precio">$${precio} / ${unidad}</div>
        <button onclick="agregarProducto('${nombre}', ${precio}, '${unidad}')">
          Agregar a la caja
        </button>
      `;

      const contenedor = document.getElementById(categoria + 's');
      if (contenedor) contenedor.appendChild(card);
    });
  }

  /*** CARGAR CAJAS ARMADAS DESDE CSV ***/
  function cargarCajas(csv) {
    const filas = parseCSV(csv).slice(1);

    filas.forEach(f => {
      const [nombre, descripcion, precio, imagen] = f;
      if (!nombre || !imagen) return;

      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${imagen.trim()}" alt="${nombre}">
        <h3>${nombre}</h3>
        <p>${descripcion}</p>
        <div class="precio">$${precio}</div>
        <button onclick="pedirCaja('${nombre}', ${precio})">
          Pedir esta caja
        </button>
      `;

      document.getElementById('cajas').appendChild(card);
    });
  }

  /*** AGREGAR PRODUCTO AL CARRITO ***/
  function agregarProducto(nombre, precio, unidad) {
    carrito.push({ nombre, precio, unidad });
    renderCarrito();
  }

  /*** RENDERIZAR CARRITO EN PANTALLA ***/
  function renderCarrito() {
    const cont = document.getElementById('items');
    cont.innerHTML = '';
    let total = 0;

    carrito.forEach((item, index) => {
      total += item.precio;
      cont.innerHTML += `
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
          <span>- ${item.nombre} ($${item.precio})</span>
          <button style="width:auto;padding:4px 8px;background:#e53935;" onclick="eliminarItem(${index})">‚úñ</button>
        </div>`;
    });

    document.getElementById('total').innerText = total;
  }

  /*** ELIMINAR UN ITEM DEL CARRITO ***/
  function eliminarItem(index) {
    carrito.splice(index, 1);
    renderCarrito();
  }

  /*** FINALIZAR PEDIDO - AGRUPAR MISMOS PRODUCTOS ***/
  function finalizarPedido() {
    if (carrito.length === 0) {
      alert('La caja est√° vac√≠a');
      return;
    }

    const resumen = {};
    let total = 0;

    carrito.forEach(item => {
      const key = item.nombre + '|' + item.unidad;
      if (!resumen[key]) {
        resumen[key] = { ...item, cantidad: 1 };
      } else {
        resumen[key].cantidad++;
      }
    });

    let mensaje = 'Hola, quiero hacer este pedido:%0A';

    Object.values(resumen).forEach(item => {
      mensaje += `- ${item.nombre}: ${item.cantidad} ${item.unidad}%0A`;
      total += item.precio * item.cantidad;
    });

    mensaje += `%0ATotal estimado: $${total}`;

    window.open(`https://wa.me/${telefono}?text=${mensaje}`);
  }

  /*** PEDIR CAJA ARMADA ***/
  function pedirCaja(nombre, precio) {
    const mensaje = `Hola, quiero pedir la ${nombre}. Total estimado $${precio}. ¬øMedios de pago y punto de entrega?`;
    window.open(`https://wa.me/${telefono}?text=${encodeURIComponent(mensaje)}`);
  }

  /*** MOSTRAR CATEGOR√çA ***/
  function mostrarCategoria(cat) {
    document.querySelectorAll('.categoria').forEach(c => c.style.display = 'none');
    if (cat === 'todas') {
      document.querySelectorAll('.categoria').forEach(c => c.style.display = 'grid');
    } else {
      document.getElementById(cat).style.display = 'grid';
    }
  }
</script>

</body>
</html>
